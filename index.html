<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProServe ‚ú® - Professional Service Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- PRO CSS & ANIMATIONS --- */
        :root {
            --primary-color: #4f46e5;
            --primary-hover: #6366f1;
            --secondary-color: #10b981;
            --danger-color: #ef4444;
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.4s ease, color 0.4s ease;
            background-color: #f0f2f5;
        }
        html.dark {
             background-color: #0f172a;
        }
        .hero-bg {
            background: linear-gradient(45deg, rgba(79, 70, 229, 0.9), rgba(16, 185, 129, 0.9)), url('https://placehold.co/1200x600/e2e8f0/e2e8f0?text=') no-repeat center center;
            background-size: cover;
        }
        .gradient-text {
            background: linear-gradient(90deg, #a5b4fc, #f9fafb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .service-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
        }
        .service-card:hover {
            transform: translateY(-12px) scale(1.03);
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
        }
        .modal-content, .confirm-modal-content {
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease;
        }
        button, .book-now-btn {
             transition: all 0.2s ease;
        }
        button:active, .book-now-btn:active {
            transform: scale(0.95);
        }
        .pro-button {
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        .pro-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.5s ease;
            z-index: -1;
        }
        .pro-button:hover::before {
            transform: translate(-50%, -50%) scale(1);
        }
        .book-now-btn:hover {
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.5);
        }

        /* --- KEYFRAME ANIMATIONS --- */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .animated-hero-text { animation: fadeInUp 0.6s ease-out 0.2s forwards; opacity: 0; }
        .animated-hero-subtext { animation: fadeInUp 0.6s ease-out 0.4s forwards; opacity: 0; }
        .animated-search { animation: fadeInUp 0.6s ease-out 0.6s forwards; opacity: 0; }
        .booking-card { animation: fadeIn 0.6s ease-out forwards; }
        
        /* --- UI POLISH --- */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        html.dark ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        html.dark ::-webkit-scrollbar-thumb { background: #475569; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }
        .step { transition: all 0.4s ease; }
        .step.active { background-color: var(--primary-color); color: white; font-weight: bold; transform: scale(1.15); box-shadow: 0 0 15px rgba(79, 70, 229, 0.5); }
        .step.completed { background-color: var(--secondary-color); color: white; }
        input:focus, select:focus, textarea:focus {
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.4);
        }
    </style>
</head>
<body class="dark:bg-slate-900 dark:text-gray-200">

    <!-- Header -->
    <header class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm shadow-md sticky top-0 z-40">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">ProServe ‚ú®</div>
            <div class="flex items-center space-x-4">
                <a href="#bookings" class="text-gray-600 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 font-medium">My Bookings</a>
                <button id="theme-toggle-btn" class="text-gray-600 dark:text-gray-300 focus:outline-none w-10 h-10 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center">
                    <i class="fas fa-moon text-xl"></i>
                </button>
                
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">
        <section class="hero-bg text-white rounded-2xl p-8 md:p-16 mb-16 text-center shadow-lg overflow-hidden">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4 animated-hero-text gradient-text">Professional Services, On-Demand üöÄ</h1>
            <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto animated-hero-subtext">Book trusted experts for everything from home cleaning to event planning, right at your fingertips.</p>
            <div class="max-w-xl mx-auto bg-white rounded-full p-2 flex items-center shadow-2xl animated-search">
                <input type="text" id="search-bar" placeholder="Search services (e.g., 'Cleaning', 'Wellness')" class="w-full bg-transparent text-gray-700 px-4 focus:outline-none">
                <button class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-6 rounded-full flex-shrink-0 pro-button">
                    <i class="fas fa-search mr-2"></i>Search
                </button>
            </div>
        </section>

        <section id="services-section">
            <h2 class="text-3xl font-bold mb-8 text-center text-gray-900 dark:text-white">Our Premier Services üèÜ</h2>
            <div id="service-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
        </section>

        <section id="bookings" class="mt-20">
            <h2 class="text-3xl font-bold mb-8 text-center text-gray-900 dark:text-white">My Bookings üóìÔ∏è</h2>
            <div id="booking-list" class="space-y-6"></div>
        </section>
    </main>
    
    <footer class="bg-white dark:bg-gray-800 mt-16 border-t border-gray-200 dark:border-gray-700">
        <div class="container mx-auto px-6 py-8 text-center text-gray-600 dark:text-gray-400">
            <p>&copy; 2025 ProServe ‚ú®. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Booking Modal -->
    <div id="booking-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col modal-content transform scale-95 opacity-0">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <div>
                    <h2 id="modal-title" class="text-2xl font-bold">Book a Service</h2>
                    <p id="modal-service-name" class="text-gray-500 dark:text-gray-400"></p>
                </div>
                <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 text-2xl">&times;</button>
            </div>
            <div class="p-6 flex justify-around border-b border-gray-200 dark:border-gray-700">
                <div id="step-1" class="step w-10 h-10 rounded-full flex items-center justify-center">1</div>
                <div class="flex-grow h-px bg-gray-300 self-center"></div>
                <div id="step-2" class="step w-10 h-10 rounded-full flex items-center justify-center">2</div>
                <div class="flex-grow h-px bg-gray-300 self-center"></div>
                <div id="step-3" class="step w-10 h-10 rounded-full flex items-center justify-center">3</div>
            </div>
            <div class="p-8 overflow-y-auto flex-grow">
                <form id="booking-form" novalidate>
                    <input type="hidden" id="service-id">
                    <div id="form-step-1">
                        <h3 class="text-xl font-semibold mb-4">1. Select Date & Time ‚è∞</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="booking-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Date</label>
                                <input type="date" id="booking-date" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg transition">
                                <p class="text-red-500 text-sm mt-1 hidden">Please select a valid date.</p>
                            </div>
                            <div>
                                <label for="booking-time" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Time</label>
                                <input type="time" id="booking-time" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg transition">
                                <p class="text-red-500 text-sm mt-1 hidden">Please select a time.</p>
                            </div>
                        </div>
                    </div>
                    <div id="form-step-2" class="hidden">
                        <h3 class="text-xl font-semibold mb-4">2. Your Details & Address üè†</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="user-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Full Name</label>
                                <input type="text" id="user-name" placeholder="Arvind Kumar" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg transition">
                                <p class="text-red-500 text-sm mt-1 hidden">Name is required.</p>
                            </div>
                            <div>
                                <label for="user-phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Phone Number</label>
                                <input type="tel" id="user-phone" placeholder="e.g., +1 987-654-3210" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg transition">
                                <p class="text-red-500 text-sm mt-1 hidden">Phone number is required.</p>
                            </div>
                        </div>
                        <div class="mt-6">
                            <label for="user-address" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Full Address</label>
                            <textarea id="user-address" rows="3" placeholder="123 Urban Lane, Service City, 12345" required class="w-full p-3 bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg transition"></textarea>
                            <p class="text-red-500 text-sm mt-1 hidden">Address is required.</p>
                        </div>
                        <div class="mt-6">
                            <label for="special-requests" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Special Requests (Optional) ‚úçÔ∏è</label>
                            <textarea id="special-requests" rows="2" placeholder="e.g., Please use eco-friendly products." class="w-full p-3 bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg transition"></textarea>
                        </div>
                    </div>
                    <div id="form-step-3" class="hidden">
                         <h3 class="text-xl font-semibold mb-4">3. Confirm & Pay üí≥</h3>
                         <div class="bg-indigo-50 dark:bg-gray-700 p-6 rounded-lg space-y-4" id="summary-container"></div>
                    </div>
                </form>
            </div>
            <div class="p-6 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-600 flex justify-end items-center space-x-4 rounded-b-2xl">
                <button id="prev-step-btn" class="py-2 px-5 bg-gray-300 dark:bg-gray-500 text-gray-800 dark:text-gray-200 font-semibold rounded-lg hover:bg-gray-400 hidden">Previous</button>
                <button id="next-step-btn" class="py-2 px-5 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-500 pro-button">Next Step <i class="fas fa-arrow-right ml-2"></i></button>
                <button id="confirm-booking-btn" type="submit" form="booking-form" class="py-2 px-5 bg-emerald-500 text-white font-semibold rounded-lg hover:bg-emerald-600 hidden pro-button">Confirm Booking üéâ</button>
            </div>
        </div>
    </div>
    
    <!-- Custom Confirmation Modal -->
    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md confirm-modal-content transform scale-95 opacity-0">
            <div class="p-8 text-center">
                <div id="confirm-modal-icon" class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 bg-red-100 text-red-500 text-3xl">
                    <i class="fas fa-trash-alt"></i>
                </div>
                <h3 id="confirm-modal-title" class="text-2xl font-bold mb-2">Cancel Booking?</h3>
                <p id="confirm-modal-text" class="text-gray-600 dark:text-gray-400 mb-6">Are you sure you want to cancel this service? This action cannot be undone.</p>
                <div class="flex justify-center space-x-4">
                    <button id="confirm-cancel-btn" class="py-2 px-6 bg-gray-300 dark:bg-gray-600 font-semibold rounded-lg hover:bg-gray-400">No, keep it</button>
                    <button id="confirm-action-btn" class="py-2 px-6 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 pro-button">Yes, cancel it!</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA (20 Services) ---
        const services = [
            { id: 1, name: 'Deep Cleaning', category: 'Home Care', icon: 'fa-broom', price: 4999, description: 'A thorough top-to-bottom cleaning for your entire home. Perfect for a fresh start.' },
            { id: 2, name: 'AC Service & Repair', category: 'Appliance Care', icon: 'fa-snowflake', price: 599, description: 'Keep your AC running efficiently with our expert cleaning and repair services.' },
            { id: 3, name: 'Event Planner', category: 'Events', icon: 'fa-calendar-check', price: 15000, description: 'Professional planning for birthdays, anniversaries, and corporate events.' },
            { id: 4, name: 'Salon for Women', category: 'Beauty & Wellness', icon: 'fa-spa', price: 999, description: 'Pamper yourself with our premium salon services, right at your doorstep.' },
            { id: 5, name: 'Plumbing Services', category: 'Home Repairs', icon: 'fa-wrench', price: 499, description: 'Expert solutions for all your plumbing needs, from leaky faucets to major installations.' },
            { id: 6, name: 'Interior Painting', category: 'Home Improvement', icon: 'fa-paint-roller', price: 8000, description: 'Refresh your space with a professional coat of paint. Quick, clean, and beautiful.' },
            { id: 7, name: 'Pest Control', category: 'Home Care', icon: 'fa-bug', price: 1200, description: 'Effective and safe solutions to keep your home free from unwanted pests.' },
            { id: 8, name: 'Personal Fitness Trainer', category: 'Beauty & Wellness', icon: 'fa-dumbbell', price: 5000, description: 'Achieve your fitness goals with a personalized training plan from a certified expert.' },
            { id: 9, name: 'Mobile & Laptop Repair', category: 'Electronics', icon: 'fa-mobile-alt', price: 799, description: 'On-site repair for your essential gadgets by certified technicians.' },
            { id: 10, name: 'Car Wash & Detailing', category: 'Auto Care', icon: 'fa-car', price: 699, description: 'A complete interior and exterior clean to make your car shine like new.' },
            { id: 11, name: 'Sofa & Carpet Cleaning', category: 'Home Care', icon: 'fa-couch', price: 1499, description: 'Deep cleaning for your upholstery to remove stains and allergens.' },
            { id: 12, name: 'Professional Photography', category: 'Events', icon: 'fa-camera', price: 12000, description: 'Capture your special moments with our experienced event photographers.' },
            { id: 13, name: 'Yoga & Meditation', category: 'Beauty & Wellness', icon: 'fa-om', price: 2500, description: 'Find your inner peace with guided yoga and meditation sessions at home.' },
            { id: 14, name: 'Electrician Services', category: 'Home Repairs', icon: 'fa-bolt', price: 399, description: 'Safe and reliable electrical services, from installations to repairs.' },
            { id: 15, name: 'Custom Cake Baking', category: 'Events', icon: 'fa-birthday-cake', price: 1500, description: 'Delicious, custom-designed cakes for any occasion, delivered to you.' },
            { id: 16, name: 'Men\'s Grooming', category: 'Beauty & Wellness', icon: 'fa-cut', price: 499, description: 'Sharp haircuts and professional grooming services for men, at home.' },
            { id: 17, name: 'Gardening & Landscaping', category: 'Home Improvement', icon: 'fa-seedling', price: 3000, description: 'Transform your outdoor space with our expert gardening services.' },
            { id: 18, name: 'Carpenter Services', category: 'Home Repairs', icon: 'fa-hammer', price: 599, description: 'Custom furniture, repairs, and installations by skilled carpenters.' },
            { id: 19, name: 'DJ for Parties', category: 'Events', icon: 'fa-music', price: 9000, description: 'Get the party started with a professional DJ for your event.' },
            { id: 20, name: 'Appliance Installation', category: 'Appliance Care', icon: 'fa-tv', price: 899, description: 'Hassle-free installation for your new TV, washing machine, and other appliances.' }
        ];

        // --- DOM ELEMENTS ---
        const serviceList = document.getElementById('service-list');
        const bookingList = document.getElementById('booking-list');
        const modal = document.getElementById('booking-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const themeToggleBtn = document.getElementById('theme-toggle-btn');
        const bookingForm = document.getElementById('booking-form');
        const searchBar = document.getElementById('search-bar');
        const confirmModal = document.getElementById('confirm-modal');
        
        // --- STATE & HELPERS ---
        let currentStep = 1;
        let confirmationCallback = null;
        const getBookings = () => JSON.parse(localStorage.getItem('proserve_bookings_v3')) || [];
        const saveBookings = (bookings) => localStorage.setItem('proserve_bookings_v3', JSON.stringify(bookings));

        // --- RENDER FUNCTIONS ---
        const renderServices = (filter = '') => {
            const filteredServices = services.filter(s => s.name.toLowerCase().includes(filter.toLowerCase()) || s.category.toLowerCase().includes(filter.toLowerCase()));
            serviceList.innerHTML = filteredServices.length ? filteredServices.map((service, index) => `
                <div class="service-card bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden cursor-pointer" data-service-id="${service.id}" style="animation-delay: ${index * 50}ms;">
                    <div class="p-6">
                        <div class="flex items-center space-x-4"><div class="bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-300 rounded-lg p-3 w-12 h-12 flex items-center justify-center"><i class="fas ${service.icon} text-2xl"></i></div><div><h3 class="text-xl font-bold text-gray-900 dark:text-white">${service.name}</h3><p class="text-sm text-gray-500 dark:text-gray-400">${service.category}</p></div></div>
                        <p class="mt-4 text-gray-600 dark:text-gray-300 h-20">${service.description}</p>
                        <div class="mt-6 flex justify-between items-center"><span class="text-2xl font-extrabold text-gray-800 dark:text-white">‚Çπ${service.price.toLocaleString('en-IN')}<span class="text-sm font-normal text-gray-500"> onwards</span></span><button class="book-now-btn bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-500 pro-button">Book Now</button></div>
                    </div>
                </div>`).join('') : `<p class="text-center col-span-full text-gray-500 py-10">No services found for "${filter}" üôÅ</p>`;
        };

        const renderBookings = () => {
            const bookings = getBookings().sort((a,b) => new Date(a.date) - new Date(b.date));
            bookingList.innerHTML = bookings.length ? bookings.map((booking, index) => {
                const service = services.find(s => s.id === booking.serviceId);
                const bookingDate = new Date(`${booking.date}T${booking.time}`);
                const isPast = bookingDate < new Date();
                return `<div class="booking-card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 flex flex-col md:flex-row items-start md:items-center gap-6 ${isPast ? 'opacity-60' : ''}" style="animation-delay: ${index * 100}ms;"><div class="bg-emerald-100 dark:bg-emerald-900 text-emerald-600 dark:text-emerald-300 rounded-lg p-4 flex flex-col items-center justify-center w-24 h-24 text-center"><span class="text-4xl font-bold">${bookingDate.getDate()}</span><span class="font-semibold">${bookingDate.toLocaleString('default', { month: 'short' })}</span></div><div class="flex-grow"><div class="flex justify-between items-start"><div><span class="text-sm font-semibold uppercase tracking-wider ${isPast ? 'text-gray-500' : 'text-emerald-500'}">${isPast ? 'Completed ‚úÖ' : 'Upcoming ‚ú®'}</span><h3 class="text-2xl font-bold text-gray-900 dark:text-white">${service.name}</h3><p class="text-gray-600 dark:text-gray-400"><i class="fas fa-clock mr-2"></i>${bookingDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} on ${bookingDate.toLocaleDateString([], { weekday: 'long' })}</p><p class="text-gray-600 dark:text-gray-400"><i class="fas fa-map-marker-alt mr-2"></i>${booking.address}</p></div><span class="text-xl font-bold text-gray-800 dark:text-white hidden md:block">‚Çπ${service.price.toLocaleString('en-IN')}</span></div></div><div class="flex space-x-2 self-start md:self-center mt-4 md:mt-0">${!isPast ? `<button class="reschedule-btn bg-blue-100 hover:bg-blue-200 text-blue-800 font-bold py-2 px-4 rounded-lg" data-booking-id="${booking.id}"><i class="fas fa-edit"></i></button>` : ''}<button class="cancel-btn bg-red-100 hover:bg-red-200 text-red-800 font-bold py-2 px-4 rounded-lg" data-booking-id="${booking.id}"><i class="fas fa-trash-alt"></i></button></div></div>`;
            }).join('') : `<div class="text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow-md"><i class="fas fa-calendar-times text-5xl text-gray-400 mb-4"></i><p class="text-gray-500 dark:text-gray-400">You have no upcoming bookings. Why not book a service today? ü•≥</p></div>`;
        };

        // --- MODAL & FORM LOGIC ---
        const openModal = (serviceId) => {
            const service = services.find(s => s.id === serviceId);
            document.getElementById('modal-service-name').textContent = service.name;
            document.getElementById('service-id').value = service.id;
            document.getElementById('booking-date').min = new Date().toISOString().split("T")[0];
            modal.classList.remove('hidden');
            setTimeout(() => modal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0'), 10);
        };

        const closeModal = () => {
            modal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => { modal.classList.add('hidden'); bookingForm.reset(); currentStep = 1; updateStepUI(); }, 300);
        };

        const updateStepUI = () => {
            document.querySelectorAll('[id^="form-step-"]').forEach((step, index) => step.classList.toggle('hidden', index + 1 !== currentStep));
            document.querySelectorAll('[id^="step-"]').forEach((indicator, index) => {
                indicator.classList.remove('active', 'completed', 'bg-gray-200', 'dark:bg-gray-600');
                if (index + 1 < currentStep) indicator.classList.add('completed');
                else if (index + 1 === currentStep) indicator.classList.add('active');
                else indicator.classList.add('bg-gray-200', 'dark:bg-gray-600');
            });
            document.getElementById('prev-step-btn').classList.toggle('hidden', currentStep === 1);
            document.getElementById('next-step-btn').classList.toggle('hidden', currentStep === 3);
            document.getElementById('confirm-booking-btn').classList.toggle('hidden', currentStep !== 3);
        };
        
        const validateStep = () => {
            const inputs = formSteps[currentStep - 1].querySelectorAll('input[required], textarea[required]');
            let isValid = true;
            inputs.forEach(input => {
                const errorP = input.nextElementSibling;
                if (!input.value) {
                    input.classList.add('border-red-500');
                    errorP.classList.remove('hidden');
                    isValid = false;
                } else {
                    input.classList.remove('border-red-500');
                    errorP.classList.add('hidden');
                }
            });
            return isValid;
        };

        const goToNextStep = () => {
            if (currentStep < 3 && validateStep()) {
                currentStep++;
                if (currentStep === 3) populateSummary();
                updateStepUI();
            }
        };

        const goToPrevStep = () => { if (currentStep > 1) { currentStep--; updateStepUI(); } };
        
        const populateSummary = () => {
            const service = services.find(s => s.id == document.getElementById('service-id').value);
            const date = document.getElementById('booking-date').value, time = document.getElementById('booking-time').value;
            const name = document.getElementById('user-name').value, address = document.getElementById('user-address').value;
            const bookingDate = new Date(`${date}T${time}`);
            document.getElementById('summary-container').innerHTML = `<h4 class="text-lg font-bold">Booking Summary</h4><div class="text-gray-700 dark:text-gray-300"><p><strong>Service:</strong> ${service.name}</p><p><strong>For:</strong> ${name}</p><p><strong>Date:</strong> ${bookingDate.toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p><p><strong>Time:</strong> ${bookingDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p><p><strong>Address:</strong> ${address}</p></div><div class="border-t border-gray-300 dark:border-gray-600 pt-4 mt-4 flex justify-between items-center"><span class="text-lg font-bold">Total Amount</span><span class="text-2xl font-extrabold text-indigo-600 dark:text-indigo-400">‚Çπ${service.price.toLocaleString('en-IN')}</span></div><div class="mt-6"><label class="flex items-center"><input type="checkbox" id="terms-agree" class="h-5 w-5 rounded text-indigo-600 focus:ring-indigo-500"><span class="ml-3 text-gray-700 dark:text-gray-300">I agree to the <a href="#" class="text-indigo-600 hover:underline">Terms of Service</a></span></label></div>`;
        };

        const handleBookingSubmit = (e) => {
            e.preventDefault();
            if(!document.getElementById('terms-agree')?.checked) { showConfirmation({ title: "Terms of Service", text: "Please agree to the terms before booking.", icon: "fa-info-circle", actionText: "OK", isAlert: true }); return; }
            const newBooking = { id: Date.now(), serviceId: parseInt(document.getElementById('service-id').value), date: document.getElementById('booking-date').value, time: document.getElementById('booking-time').value, name: document.getElementById('user-name').value, phone: document.getElementById('user-phone').value, address: document.getElementById('user-address').value, requests: document.getElementById('special-requests').value };
            saveBookings([...getBookings(), newBooking]);
            closeModal();
            renderBookings();
        };

        // --- CUSTOM CONFIRMATION MODAL ---
        const showConfirmation = ({ title, text, icon, actionText, isAlert = false }, callback) => {
            document.getElementById('confirm-modal-title').textContent = title;
            document.getElementById('confirm-modal-text').textContent = text;
            document.getElementById('confirm-modal-icon').innerHTML = `<i class="fas ${icon}"></i>`;
            document.getElementById('confirm-action-btn').textContent = actionText;
            document.getElementById('confirm-cancel-btn').classList.toggle('hidden', isAlert);
            confirmModal.classList.remove('hidden');
            setTimeout(() => confirmModal.querySelector('.confirm-modal-content').classList.remove('scale-95', 'opacity-0'), 10);
            confirmationCallback = callback;
        };
        const hideConfirmation = () => {
            confirmModal.querySelector('.confirm-modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => { confirmModal.classList.add('hidden'); confirmationCallback = null; }, 300);
        };
        document.getElementById('confirm-action-btn').addEventListener('click', () => { if (confirmationCallback) confirmationCallback(); hideConfirmation(); });
        document.getElementById('confirm-cancel-btn').addEventListener('click', hideConfirmation);


        const handleBookingActions = (e) => {
            const target = e.target.closest('button');
            if (!target) return;
            const bookingId = parseInt(target.dataset.bookingId);
            if (target.classList.contains('cancel-btn')) {
                showConfirmation({ title: 'Cancel Booking?', text: 'Are you sure? This action cannot be undone.', icon: 'fa-trash-alt', actionText: 'Yes, cancel it!' }, () => {
                    saveBookings(getBookings().filter(b => b.id !== bookingId));
                    renderBookings();
                });
            }
        };

        // --- THEME TOGGLE ---
        const applyTheme = (isDark) => {
            const icon = themeToggleBtn.querySelector('i');
            document.documentElement.classList.toggle('dark', isDark);
            icon.classList.replace(isDark ? 'fa-moon' : 'fa-sun', isDark ? 'fa-sun' : 'fa-moon');
        };
        const toggleTheme = () => {
            const isDark = !document.documentElement.classList.contains('dark');
            localStorage.setItem('proserve_theme_v3', isDark);
            applyTheme(isDark);
        };

        // --- EVENT LISTENERS ---
        serviceList.addEventListener('click', (e) => { const card = e.target.closest('.service-card'); if (card) openModal(parseInt(card.dataset.serviceId)); });
        searchBar.addEventListener('input', (e) => renderServices(e.target.value));
        closeModalBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
        themeToggleBtn.addEventListener('click', toggleTheme);
        bookingForm.addEventListener('submit', handleBookingSubmit);
        bookingList.addEventListener('click', handleBookingActions);
        document.getElementById('next-step-btn').addEventListener('click', goToNextStep);
        document.getElementById('prev-step-btn').addEventListener('click', goToPrevStep);
        const formSteps = [document.getElementById('form-step-1'), document.getElementById('form-step-2')];

        // --- INITIALIZATION ---
        applyTheme(localStorage.getItem('proserve_theme_v3') === 'true');
        renderServices();
        renderBookings();
    });
    </script>
</body>
</html>
